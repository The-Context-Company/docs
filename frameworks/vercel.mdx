---
title: "Vercel AI SDK (Next.js)"
description: "Observability for Vercel AI SDK in 10 lines of code"
---

<Note>
We currently only support AI SDK observability in Next.js apps. Support for other environments coming soon.
</Note>

## Setup

### Step 1: Install dependencies

<CodeGroup>
```Title pnpm
pnpm add @contextcompany/otel @vercel/otel @opentelemetry/api
```
```Title npm
npm i @contextcompany/otel @vercel/otel @opentelemetry/api
```
</CodeGroup>

### Step 2: Add instrumentation to Next.js

You'll need to add an `instrumentation.[js|ts]` file to your project, under the `app` directory. See the [Next.js Instrumentation guide](https://nextjs.org/docs/app/guides/instrumentation) for more information on instrumenting your Next.js application.

Call the `registerOTelTCC` function and provide your API key and OTLP URL. This allows your app to export
any AI SDK related traces to The Context Company.

```typescript instrumentation.ts
import { registerOTelTCC } from "@contextcompany/otel";

export function register() {
  if (process.env.NEXT_RUNTIME === "nodejs")
    registerOTelTCC({
      url: process.env.TCC_OTLP_URL,
      apiKey: process.env.TCC_API_KEY,
    });
}
```

### Step 3: Enable telemetry for AI SDK calls
AI SDK Telemetry is experimental and requires the `experimental_telemetry` flag to be set to `true`.
<CodeGroup>
```typescript generateText
import { generateText } from "ai";

const result = generateText({
  // ...
  experimental_telemetry: { isEnabled: true }, // required
});
```

```typescript streamText
import { streamText } from "ai";

const result = streamText({
  // ...
  experimental_telemetry: { isEnabled: true }, // required
});
```

</CodeGroup>

## Usage

### Adding custom metadata

Custom metadata allows you to add additional properties to your [Agent Runs](/concepts#agent-runs).

This is particularly useful for tying agent runs to your own specific business logic, letting you filter and analyze agent runs by user, organization, feature, or some other dimension.

Custom metadata must be passed as a key-value pair to the `metadata` object. 

```typescript route.ts
import { openai } from "@ai-sdk/openai";
import { generateText } from "ai";

const { text } = await generateText({
  // ...
  experimental_telemetry: {
    isEnabled: true,
    metadata: {
      // e.g. tag this agent run with a user id
      userId: "4a6b111c-b53a-4d00-a877-67185022ab9e",
    },
  },
});
```

Agent runs are automatically indexed on your custom metadata fields and are filterable in the dashboard. 